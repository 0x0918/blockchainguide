## Kademlia基本介绍

## 路由表

Kademlia路由表由节点ID每一位的*列表*组成。（例如，如果一个节点ID由128位组成，则一个节点将保留128个这样的*列表*。）

这些*列表*称为*k-buckets*。*k*是系统范围的数字，例如20。每个k-bucket是一个*列表*，其中最多包含*k*个条目；例如，对于一个k = 20的网络，每个节点将具有一个*列表，*其中包含多达20个节点的特定位（与自身之间的特定距离）

一个**列表**有很多**条目**，*列表中的*每个条目都包含必要的数据，以定位另一个节点。

每个条目中的数据通常是另一个节点的*IP地址*，*端口*和*节点ID*。

每个*列表*对应于到节点的特定距离。？可以进入第n个*列表的*节点必须具有不同的第n个节点位从节点的ID。

候选ID的前n-1位必须与节点ID的前n-1位匹配。这意味着填充第一个*列表*非常容易，因为网络中有1/2个节点是距离较远的候选对象。下一个*列表*只能使用网络中1/4的节点（比第一个节点近一点），等等。

ID为128位时，网络中的每个节点将按照128个不同距离之一（每位特定距离）对其他节点进行分类。



## 节点距离

Kad网络中每个节点都有一个160bit的ID值作为标志符，Key也是一个160bit的标志符，每一个加入Kad网络的节点都会被分配一个160bit的节点ID（node ID），这个ID值是随机产生的。同时对的数据就存放在ID值距离key值最近的若干个节点上。

- (A ⊕ B) == (B ⊕ A)：对称性，A到B的距离和B到A的距离是相等的。

- (A ⊕ A) == 0：节点自身与自身的距离是0

- (A ⊕ B) > 0 ：任意两个节点之间的距离一定大于0

- (A ⊕ B) + (B ⊕ C) >= (A ⊕ C)：三角不等，A经过B到C的距离总是大于等于A直接到C的距离

距离不仅可以应用在节点之间，也可以应用在节点和键值之间。这在键值查找中很有用。

例如：

> 节点A的ID（011）和节点B的ID（101）距离：011 ⊕ 101 = 110 = 4+2 = 6。



## 协议消息

分为4种消息：

- PING 检查节点是否在线
- STORE 在某个节点中存储一个键值对
- FIND_NODE 返回对方节点桶中离请求键值最近的 K 个节点
- FIND_VALUE 与 FIND_NODE 一样，不过当请求的接收者存有请求者所请求的键的时候，它将返回相应键的值

## 定位节点

## 查找资源

## 加入网络

## 加速查找

